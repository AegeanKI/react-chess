(this["webpackJsonpreact-chess"]=this["webpackJsonpreact-chess"]||[]).push([[0],{12:function(e,t,n){"use strict";n.r(t);var i=n(7),a=n(4),r=n(3),o=n(10),s=n(1),c=n(2),u=n(5),l=n.n(u),h=n(11),d=n.n(h),y=(n(17),n(0)),v=function(){function e(t,n){Object(s.a)(this,e),this.y=t,this.x=n}return Object(c.a)(e,[{key:"add",value:function(t){return new e(this.y+t.y,this.x+t.x)}},{key:"minus",value:function(t){return new e(this.y-t.y,this.x-t.x)}},{key:"equal",value:function(e){return null!==e&&this.y===e.y&&this.x===e.x}},{key:"mul",value:function(t){return new e(this.y*t,this.x*t)}},{key:"div",value:function(t){return new e(this.y/t,this.x/t)}},{key:"step",value:function(t,n){return new e(this.y+t,this.x+n)}},{key:"xDis",value:function(e){return Math.abs(this.x-e.x)}},{key:"yDis",value:function(e){return Math.abs(this.y-e.y)}},{key:"xEqual",value:function(e){return 0===this.xDis(e)}},{key:"yEqual",value:function(e){return 0===this.yDis(e)}}]),e}();function p(e,t){switch(e){case"pawn":return new g(t);case"queen":return new w(t);case"king":return new j(t);case"rock":return new k(t);case"bishop":return new b(t);case"knight":return new m(t);default:return null}}var f=function(){function e(t){Object(s.a)(this,e),this.squares=t.map((function(e){return e.map((function(e){return e?e.copyPiece():null}))}))}return Object(c.a)(e,[{key:"copyBoard",value:function(){return new e(this.squares)}},{key:"isValidCoord",value:function(e){return null!==e&&e.y>=0&&e.y<8&&e.x>=0&&e.x<8}},{key:"getPiece",value:function(e){return this.isValidCoord(e)?this.squares[e.y][e.x]:null}},{key:"getPieceCanMovePosition",value:function(e,t){if(this.isValidCoord(e)){var n=this.getPiece(e),i=n.getCanMovePositionInGeneralRule(e,this);return n.updateCanMovePositionInSpecialRule(e,this,i,t)}return[]}},{key:"hasPiece",value:function(e){return!!this.isValidCoord(e)&&null!==this.squares[e.y][e.x]}},{key:"hasNoPiece",value:function(e){return!!this.isValidCoord(e)&&null===this.squares[e.y][e.x]}},{key:"isSamePieceColor",value:function(e,t){return this.getPiece(e).pieceColor===this.getPiece(t).pieceColor}},{key:"isSamePieceType",value:function(e,t){return this.getPiece(e).pieceType===t}},{key:"canEatPiece",value:function(e,t){return this.isValidCoord(t)&&this.hasPiece(t)&&!this.isSamePieceColor(e,t)}},{key:"setPiece",value:function(e,t){this.isValidCoord(e)&&(this.squares[e.y][e.x]=t)}},{key:"removePiece",value:function(e){this.setPiece(e,null)}},{key:"isDoingEnPassant",value:function(e){return!!this.isValidCoord(e)&&(this.isSamePieceType(e,"pawn")&&(0===e.y||7===e.y))}},{key:"isUsingSpeicalRule",value:function(e,t){var n=this.isSamePieceType(e,"pawn")&&1===e.xDis(t)&&!this.hasPiece(t)?1:null,i=this.isSamePieceType(e,"king")&&2===e.xDis(t)?2:null;return n||i}},{key:"updateBoardByEnPassant",value:function(e,t){var n=this.copyBoard(),i=this.getPiece(e).pieceColor,a=0===t.yDis(e)?p("queen",i):1===t.yDis(e)?p("knight",i):2===t.yDis(e)?p("rock",i):3===t.yDis(e)?p("bishop",i):null;return n.setPiece(e,a),n}},{key:"updateSquaresUsingSpecialRule",value:function(e,t,n){var i=this.copyBoard();if(1===e)i.removePiece(new v(t.y,n.x));else if(2===e){var a=n.minus(t).div(2),r=a.x>0?new v(t.y,7):new v(t.y,0);i.setPiece(n.minus(a),this.getPiece(r)),i.removePiece(r)}return i}},{key:"updateBoardByMoving",value:function(e,t){var n=this.copyBoard(),i=this.isUsingSpeicalRule(e,t);return i&&(n=this.updateSquaresUsingSpecialRule(i,e,t)),n.setPiece(t,n.getPiece(e)),n.removePiece(e),n.getPiece(t).setAlreadyMoved(),n}},{key:"updateBoardByPiece",value:function(e,t){return this.isDoingEnPassant(e)?this.updateBoardByEnPassant(e,t):this.updateBoardByMoving(e,t)}},{key:"mayLoose",value:function(e,t){for(var n=this.updateBoardByPiece(e,t),i=null,a=0;a<8;a++)for(var r=0;r<8;r++){var s=new v(a,r);if(n.hasPiece(s)&&!n.isSamePieceColor(t,s))if(n.isSamePieceType(s,"king"))i=s;else if(n.getPieceCanMovePosition(s,{startPos:e,endPos:t,piece:n.getPiece(t)}).some((function(e){return e.equal(t)})))return!0}var c,u=n.getPiece(i).direction,l=Object(o.a)(u);try{for(l.s();!(c=l.n()).done;){var h=c.value;if(i.add(h).equal(t))return!0}}catch(d){l.e(d)}finally{l.f()}return!1}}]),e}(),P=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Math.max(8,8);Object(s.a)(this,e),this.pieceColor=t,this.pieceType=n,this.alreadyMoved=i,this.direction=a,this.maxMultiple=r}return Object(c.a)(e,[{key:"getCanMovePositionInGeneralRule",value:function(e,t){var n=this,i=[];return this.direction.forEach((function(a){for(var r=1;r<=n.maxMultiple;r++){var o=e.add(a.mul(r));if(!t.isValidCoord(o))break;if(t.hasPiece(o)){t.canEatPiece(e,o)&&i.push(o);break}i.push(o)}})),i}},{key:"updateCanMovePositionInSpecialRule",value:function(e,t,n,i){return n}},{key:"getAlreadyMoved",value:function(){return this.alreadyMoved}},{key:"setAlreadyMoved",value:function(){this.alreadyMoved=!0}}]),e}(),g=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(s.a)(this,n),t.call(this,e,"pawn",i)}return Object(c.a)(n,[{key:"copyPiece",value:function(){return new n(this.pieceColor,this.alreadyMoved)}},{key:"getCanMovePositionInGeneralRule",value:function(e,t){var n="white"===this.pieceColor?6:1,i="white"===this.pieceColor?-1:1,a=e.step(i,0),r=e.step(2*i,0),o=[];return t.isValidCoord(a)&&!t.hasPiece(a)&&o.push(a),e.y!==n||t.hasPiece(a)||t.hasPiece(r)||o.push(r),o}},{key:"updateCanMovePositionInSpecialRule",value:function(e,t,n,i){var a="white"===this.pieceColor?-1:1,r=e.step(a,1),o=e.step(a,-1),s=n.slice();return t.canEatPiece(e,r)&&s.push(r),t.canEatPiece(e,o)&&s.push(o),i&&"pawn"===i.piece.pieceType&&2===i.startPos.yDis(i.endPos)&&1===i.startPos.xDis(e)&&0===i.endPos.yDis(e)&&s.push(new v(e.y+a,i.startPos.x)),s}}]),n}(P),k=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.a)(this,n);var a=[new v(1,0),new v(0,1),new v(-1,0),new v(0,-1)];return t.call(this,e,"rock",i,a)}return Object(c.a)(n,[{key:"copyPiece",value:function(){return new n(this.pieceColor,this.alreadyMoved)}}]),n}(P),b=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.a)(this,n);var a=[new v(1,1),new v(1,-1),new v(-1,1),new v(-1,-1)];return t.call(this,e,"bishop",i,a)}return Object(c.a)(n,[{key:"copyPiece",value:function(){return new n(this.pieceColor,this.alreadyMoved)}}]),n}(P),w=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.a)(this,n);var a=[new v(1,0),new v(0,1),new v(-1,0),new v(0,-1),new v(1,1),new v(1,-1),new v(-1,1),new v(-1,-1)];return t.call(this,e,"queen",i,a)}return Object(c.a)(n,[{key:"copyPiece",value:function(){return new n(this.pieceColor,this.alreadyMoved)}}]),n}(P),m=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.a)(this,n);var a=[new v(2,1),new v(-2,1),new v(2,-1),new v(-2,-1),new v(1,2),new v(1,-2),new v(-1,2),new v(-1,-2)];return t.call(this,e,"knight",i,a,1)}return Object(c.a)(n,[{key:"copyPiece",value:function(){return new n(this.pieceColor,this.alreadyMoved)}}]),n}(P),j=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.a)(this,n);var a=[new v(1,1),new v(-1,1),new v(1,-1),new v(-1,-1),new v(1,0),new v(0,-1),new v(-1,0),new v(0,1)];return t.call(this,e,"king",i,a,1)}return Object(c.a)(n,[{key:"copyPiece",value:function(){return new n(this.pieceColor,this.alreadyMoved)}},{key:"updateCanMovePositionInSpecialRule",value:function(e,t,n,i){if(n=n.filter((function(n){return!t.mayLoose(e,n)})),!t.getPiece(e).getAlreadyMoved()){var a=[new v(e.y,0),new v(e.y,7)],r=[new v(0,-1),new v(0,1)];a.forEach((function(a,o){if(t.hasPiece(a)&&t.isSamePieceType(a,"rock")&&!t.getPiece(a).getAlreadyMoved()){for(var s=e.add(r[o]);!a.equal(s);s=s.add(r[o]))if(t.hasPiece(s))return;if(t.mayLoose(e,e.add(r[o]),i)||t.mayLoose(e,e.add(r[o].mul(2)),i))return;n.push(e.add(r[o].mul(2)))}}))}return n}}]),n}(P),C=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e=this,t="square "+this.props.squareBackgroundColor;return Object(y.jsxs)("button",{className:t,onClick:function(){return e.props.onClick()},children:[this.props.pieceImgSrc?Object(y.jsx)("img",{src:this.props.pieceImgSrc,alt:this.props.pieceImgSrc}):null,this.props.stackImgSrc?Object(y.jsx)("img",{className:"stack-image",src:this.props.stackImgSrc,alt:this.props.stackImgSrc}):null,this.props.rowIndicatorValue?Object(y.jsx)("p",{className:"row-indicator",children:this.props.rowIndicatorValue}):null,this.props.colIndicatorValue?Object(y.jsx)("p",{className:"col-indicator",children:this.props.colIndicatorValue}):null]})}}]),n}(l.a.Component),M=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"renderSquare",value:function(e){var t=this,n=8*e.y+e.x,i=0===e.x?8-e.y:null,a=7===e.y?String.fromCharCode(97+e.x):null,r=this.props.doingEnPassantCoord,o=this.props.board.getPiece(e),s=this.props.board.getPiece(r),c=this.props.mayMovePosition.some((function(t){return t.equal(e)})),u=e.equal(r)?"orange-square":e.equal(this.props.tryToMove)?"yellow-square":(e.y+e.x)%2===0?"black-square":"white-square",l=r&&e.xEqual(r)&&e.yDis(r)<4?"light-mask":r&&!e.equal(r)?"dark-mask":null,h=c&&o&&o.pieceType?"/react-chess/circle.png":c?"/react-chess/dot.png":l?"/react-chess/"+l+".png":null,d="light-mask"===l&&0===e.yDis(r)?"/react-chess/"+s.pieceColor+"-queen.png":"light-mask"===l&&1===e.yDis(r)?"/react-chess/"+s.pieceColor+"-knight.png":"light-mask"===l&&2===e.yDis(r)?"/react-chess/"+s.pieceColor+"-rock.png":"light-mask"===l&&3===e.yDis(r)?"/react-chess/"+s.pieceColor+"-bishop.png":o?"/react-chess/"+o.pieceColor+"-"+o.pieceType+".png":null;return Object(y.jsx)(C,{rowIndicatorValue:i,colIndicatorValue:a,pieceImgSrc:d,stackImgSrc:h,squareBackgroundColor:u,mayMove:c,usingMask:l,onClick:function(){return t.props.onClick(e)}},n)}},{key:"render",value:function(){var e=this;return Object(y.jsx)("div",{className:"chess-board-container",children:Object(i.a)(Array(8)).map((function(t,n){return Object(y.jsx)("div",{className:"chess-board-row",children:Object(i.a)(Array(8)).map((function(t,i){return e.renderSquare(new v(n,i))}))},n)}))})}}]),n}(l.a.Component),O=function(e){Object(a.a)(n,e);var t=Object(r.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e)).state={board:new f(i.getInitBoard()),nextColor:"white",tryToMove:null,mayMovePosition:[],historyMove:[],doingEnPassantCoord:null},i}return Object(c.a)(n,[{key:"getInitBoard",value:function(){var e=Array(8).fill(0).map((function(e){return Array(8).fill(null)})),t="rock knight bishop queen king bishop knight rock".split(" ");return e[0]=t.map((function(e){return p(e,"black")})),e[1]=Object(i.a)(Array(8)).map((function(e){return p("pawn","black")})),e[6]=Object(i.a)(Array(8)).map((function(e){return p("pawn","white")})),e[7]=t.map((function(e){return p(e,"white")})),e}},{key:"handleDoingEnPassant",value:function(e){var t=this.state.doingEnPassantCoord;if(!(Math.abs(t.y-e.y)>=4||t.x!==e.x)){var n=this.state.board.updateBoardByPiece(t,e);this.setState({board:n,doingEnPassantCoord:null,tryToMove:null,mayMovePosition:[]})}}},{key:"handlePieceMoving",value:function(e){var t=this.state.historyMove.slice(),n=this.state.board.updateBoardByPiece(this.state.tryToMove,e);t.push({startPos:this.state.tryToMove,endPos:e,piece:n.getPiece(e)}),this.setState({board:n,nextColor:"black"===this.state.nextColor?"white":"black",historyMove:t,tryToMove:null,mayMovePosition:[]}),n.isDoingEnPassant(e)&&this.setState({doingEnPassantCoord:e})}},{key:"handlePieceTryToMove",value:function(e){var t=this.state.board,n=this.state.historyMove.slice(),i=t.getPieceCanMovePosition(e,n[n.length-1]);this.setState({tryToMove:e,mayMovePosition:i})}},{key:"handleOperationCancel",value:function(e){this.setState({tryToMove:null,mayMovePosition:[]})}},{key:"handleClick",value:function(e){this.state.doingEnPassantCoord?this.handleDoingEnPassant(e):this.state.mayMovePosition.some((function(t){return t.equal(e)}))?this.handlePieceMoving(e):this.state.board.hasPiece(e)&&this.state.board.getPiece(e).pieceColor===this.state.nextColor?this.handlePieceTryToMove(e):this.handleOperationCancel(e)}},{key:"render",value:function(){var e=this;return Object(y.jsx)("div",{className:"game",children:Object(y.jsx)("div",{className:"game-chess-board",children:Object(y.jsx)(M,{board:this.state.board,onClick:function(t){return e.handleClick(t)},tryToMove:this.state.tryToMove,mayMovePosition:this.state.mayMovePosition,doingEnPassantCoord:this.state.doingEnPassantCoord})})})}}]),n}(l.a.Component);d.a.render(Object(y.jsx)(O,{}),document.getElementById("root"))},17:function(e,t,n){}},[[12,1,2]]]);
//# sourceMappingURL=main.5fe60efc.chunk.js.map